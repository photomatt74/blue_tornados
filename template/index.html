<!DOCTYPE html>
<html>

<head>
    <meta charset=utf-8 />
    <title>Draft</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <link href='http://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: whitesmoke;
            font-family: Lato, sans-serif;
            color: #0D0000;
        }

        header,
        footer,
        section {
            padding: 6px 10%;
            margin: 0 auto;
            width: 80%
        }

        h1 {
            display: inline-block;
            margin-right: 20px;
            color: #001323;
        }

        h2 {
            display: inline-block;
            color: #001323;
        }

        #map {
            width: 80%;
            height: 740px;
            margin: 10px 10%;
            background: whitesmoke;
            border: 2px solid #dddedf;
        }

        a {
            color: #004A8B;
        }

        a:hover {
            color: rgb(67, 69, 71);
            text-decoration: none;
        }

        p {
            font-size: 1em;
            color: #001323;
        }

        .legend {
            padding: 6px 8px;
            font-size: 1em;
            /* Use transparency to blend elements. */
            border: 2px solid rgba(145, 168, 153, 0.2);
            background: rgba(233, 232, 232, 0.9);
            color: rgba(0, 0, 0, 0.8);
            border-radius: 5px;
        }

        .legend h3 {
            font-size: 1.3em;
            font-weight: bolder;
            color: rgb(4, 4, 4);
            /* Light */
            margin: 0 0 10px 0;
        }

        .legend span {
            width: 20px;
            height: 20px;
            float: left;
            margin: 0 10px 4px 0;
        }

        .legend label {
            font-size: 1em;
        }

        .legend label:after {
            content: ' ';
            display: block;
            clear: both;
        }

        .leaflet-bar a {
            /* Override the default style for Leaflet's zoom  */
            background: rgba(100, 100, 100, 0.9);
            color: rgba(244, 244, 244, 0.8);
        }

        footer {
            padding: 6px 10%;
            width: 80%;
        }

        p {
            font-size: 1em;
            color: #001323;
        }
    </style>
</head>

<body>
    <header>
        <h1>Kentucky Tornados:</h1>
        <h2>It's Weird Weather</h2>
    </header>

    <div id='map'></div>
    <footer>
        <p>Map authored by Matt Barton</p>
        <p>Are we having more tornados in Kentucky? This map will show tornados in Kentucky by location and decade.
        </p>
    </footer>

    <!-- Load scripts using Subresource Integrity (SRI) is a security feature 
      that enables browsers to verify that resources they fetch (from a CDN) 
      are delivered without unexpected manipulation. -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <script src="data/ky_tornados_1961_2021.js">
    </script>

    <script>
        var map = L.map('map', {
            center: [37.8, -85.8], // centered in Kentucky
            zoom: 7
        });

        var tiles = L.tileLayer(
            'https://cartodb-basemaps-{s}.global.ssl.fastly.net/rastertiles/dark_all/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',
                subdomains: 'abcd',
                maxZoom: 19
            });
        tiles.addTo(map);

        // commonStyles 
        var commonStyles = {
            stroke: true,
            fill: true,
            fillOpacity: .8,
            radius: 200,
            color: '#1F78B4'
        }; // styles closed

        var hotStyles = {
            stroke: true,
            fill: true,
            fillOpacity: 1,
            radius: 200,
            color: '#cf2525'
        }; // styles closed

        // Global vars

        var layerInfo = {
            tornadoLayer: {
                lat: "BEGIN_LAT",
                lng: "BEGIN_LNG",
                color: '#cf2525'
            },
            funnelLayer: {
                lat: "BEGIN_LAT",
                lng: "BEGIN_LNG",
                color: '#e6e22c'
            }
        }; // info closed

        // var place = [layerInfo.lat,layerInfo.lng];

        //  Create empty layer group
        let tornadoGroup = L.layerGroup();

        //  Loop through the data and create a line for each valid feature
        for (let t of tornados) {

            // Load coordinates and convert them to numbers with + operator
            const cords = [
                +t.BEGIN_LAT, +t.BEGIN_LON, +t.END_LAT, +t.END_LON
            ]
            var tip = `${t.EVENT_TYPE}<br>${t.BEGIN_DATE}`;
            // Test all four values to see if they are valid
            const check = cords.every(cord => {

                // Returns true if all values are valid
                return typeof (cord) === 'number' && !isNaN(cord) && cord !== 0;
            })
            // If true, build the line and add it to the layergroup
            if (check) {
                const polyline = L.polyline([
                    [cords[0], cords[1]],
                    [cords[2], cords[3]]
                ], commonStyles).bindTooltip(tip)

                // define toolTipInfo
                // var toolTipInfo =`me`;
                //     console.log(t.CZ_NAME_STR)
                //  Style and create popup content
                // Create functions to draw legend, add interactivity, etc. because you have access to properties here
                // tornadoGroup.bindTooltip(t.CZ_NAME_STR);

                tornadoGroup.addLayer(polyline);

            } else {
                if ((typeof (cords[0]) === 'number' && !isNaN(cords[0]) && cords[0] !== 0) && (typeof (cords[1]) ===
                        'number' && !isNaN(cords[1]) && cords[1] !== 0)) {
                    var place = [cords[0], cords[1]];
                    console.log(place);
                    const dot = L.circle(place, commonStyles).bindTooltip(tip)
                    tornadoGroup.addLayer(dot);
                }
                // console.log(place)
            }
        }

        tornadoGroup.addTo(map);
        drawMap(tornadoGroup);

        function drawMap(tornadoGroup) {

            tornadoGroup.eachLayer(function (layer) {

                layer.on('mouseover', function () {
                    layer.setStyle(hotStyles);
                });
                layer.on('mouseout', function () {
                    layer.setStyle(commonStyles);
                });
                // if (L.Browser.mobile) {
                //   // if true use popup
                //   layer.bindPopup(toolTipInfo);
                // } else {
                //   // if false use tooltip
                //   layer.bindTooltip(toolTipInfo, 
                // {sticky: true,
                //   maxHeight: 10,
                //   offset: [15,0] });
                // };

            }); // close each layer
        }; // close drawMap

        // tornadoGroup can now have events added to it

        // var geoJsonLayers = {};  // trying to make a json into a geoJSON

        // for (var layer in layerInfo) {

        //   geoJsonLayers[layer] = L.geoJson(tornados, {

        //     pointToLayer: function (feature, place) {
        //       return L.circleMarker(place, commonStyles);
        //     },
        //     // filter: function (feature) {
        //     //   if (feature.properties.fuel_source[layerInfo[layer].source]) {
        //     //     return feature;
        //     //   }
        //     // },

        //     style: function (feature) {
        //       return {
        //         color: layerInfo[layer].color,
        //         fillColor: layerInfo[layer].color,
        //         radius: 200
        //       }
        //     }
        //   }).addTo(map);
        // } // for loop closed

        // var sourcesLabels = {
        //   "Tornados": geoJsonLayers.tornadoLayer,
        //   "Funnel Clouds": geoJsonLayers.funnelLayer
        // } // labels closed

        // L.control.layers(null, sourcesLabels, {
        //   collapsed: false
        // }).addTo(map);
    </script>

</body>

</html>

<!-- console.log(`layerInfo[gsLayer]: ${layerInfo[gsLayer].source} \n*******\n`)
console.log(`geoJsonLayers[gsLayer]: ${geoJsonLayers[gsLayer]} \n*******\n`)
console.log(`gsLayer: ${gsLayer} \n*******\n`)
console.log(`layer: ${layer} \n*******\n`) -->